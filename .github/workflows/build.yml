name: Build and Publish WPF App

on:
  workflow_dispatch:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

jobs:
  build:
    runs-on: windows-latest
    env:
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'

    - name: Restore dependencies
      run: dotnet restore GeoLoom.sln

    - name: Build solution
      run: dotnet build MinimalApp/MinimalApp.csproj --configuration Release

    - name: Publish app
      run: dotnet publish MinimalApp/MinimalApp.csproj --configuration Release --output MinimalApp/publish

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: wpf-build
        path: MinimalApp/publish/
        

    - name: Send email notification
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.sendgrid.net
        server_port: 587
        username: apikey
        password: ${{ secrets.SENDGRID_API_KEY }}
        subject: "âœ… Build terminÃ© avec succÃ¨s"
        to: gael.pidoux@ynov.com
        from: gael.pidoux@ynov.com
        body: |
          Le pipeline CI/CD GeoLoom WPF sâ€™est terminÃ© avec succÃ¨s. ðŸŽ‰


